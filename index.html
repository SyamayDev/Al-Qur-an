<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="Description" content="Al-Qur'an Online Dengan Terjemahan Bahasa Indonesia (equran.id + Audio Alafasy)">

  <!-- Bootstrap CSS -->
  <link 
    rel="stylesheet"
    href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z"
    crossorigin="anonymous"
  >
  <!-- Font Awesome -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
  >
  <!-- Google Fonts -->
  <link
    href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900"
    rel="stylesheet"
  >
  <!-- DataTables CSS -->
  <link
    href="https://cdn.datatables.net/1.10.22/css/jquery.dataTables.min.css"
    rel="stylesheet"
  >
  <!-- Select2 CSS -->
  <link
    href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css"
    rel="stylesheet"
  >
  <!-- Google Font untuk teks Arab (Lateef) -->
  <link
    rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Lateef&display=swap"
  >

  <title>Al-Qur'an</title>

  <style>
    /* ---------------------------------------------------------
       1. SPINNER LOADING
    --------------------------------------------------------- */
    .spinner {
      width: 100px;
      height: 100px;
      border: 12px solid #f3f3f3;
      border-top: 12px solid #28a745;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 20px auto;
    }
    @keyframes spin {
      0%   { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* ---------------------------------------------------------
       2. ANIMASI CENTANG (COPY)
    --------------------------------------------------------- */
    @keyframes fadeInOut {
      0%   { opacity: 0; transform: scale(0.5); }
      50%  { opacity: 1; transform: scale(1.2); }
      100% { opacity: 0; transform: scale(0.5); }
    }
    .copied-check {
      animation: fadeInOut 1s ease-out;
    }

    /* ---------------------------------------------------------
       3. LAYOUT UMUM
    --------------------------------------------------------- */
    body {
      margin: 0;
      padding: 0;
      background-color: #fff;
      color: #212529;
      font-family: 'Roboto', sans-serif;
      transition: background-color 0.3s, color 0.3s;
    }
    .navbar-brand {
      font-size: 2rem;
      font-weight: 700;
    }
    .card {
      border-radius: 10px;
      transition: box-shadow 0.3s;
    }
    .card:hover {
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .card-header {
      border-top-left-radius: 10px;
      border-top-right-radius: 10px;
    }
    .modal-content {
      border-radius: 10px;
    }
    .modal-header {
      border-top-left-radius: 10px;
      border-top-right-radius: 10px;
    }

    /* ---------------------------------------------------------
       4. TABLE / DATATABLE
    --------------------------------------------------------- */
    table.dataTable {
      width: 100% !important;
      table-layout: auto !important;
      white-space: normal !important;
      border-radius: 8px;
      overflow: hidden;
    }
    table.dataTable thead th {
      background-color: #e9ecef;
      color: #212529;
      border-bottom: 2px solid #dee2e6;
    }
    table.dataTable tbody tr:hover {
      background-color: #f8f9fa;
    }
    table.dataTable thead th, table.dataTable tbody td {
      padding: 0.5rem;
    }

    /* ---------------------------------------------------------
       5. TEKS ARAB & KHUSUS AL-FATIHAH
    --------------------------------------------------------- */
    .arabic-text {
      font-family: 'Lateef', serif;
      direction: rtl;
      text-align: right;
      font-size: 3rem;
      line-height: 1.8;
    }
    .alfatihah-text {
      font-family: 'Lateef', serif;
      font-size: 3.5rem;
      color: white;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    /* ---------------------------------------------------------
       6. CUSTOM AUDIO PLAYER
    --------------------------------------------------------- */
    .audio-player {
      display: flex;
      align-items: center;
      background: #dcdcdc;
      border: 1px solid #e0e0e0;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      padding: 8px 3px;
    }
    .audio-player button {
      border: none;
      background: none;
      font-size: 0.8rem;
      margin-right: 10px;
      cursor: pointer;
      transition: color 0.2s;
    }
    .audio-player button:hover {
      color: #28a745;
    }
    .audio-player input[type=range] {
      flex: 1;
      margin-right: 10px;
      cursor: pointer;
    }

    /* ---------------------------------------------------------
       7. CARD & MODAL HEADER KHUSUS
    --------------------------------------------------------- */
    .my-card-header {
      background-color: #28a745;
      color: #fff;
    }
    .my-modal-header {
      background-color: #28a745;
      color: #fff;
    }
    .my-modal-content {
      border: 1px solid #28a745;
    }

    /* ---------------------------------------------------------
       8. DARK MODE
       (aktif otomatis jika OS user preferensi "dark mode")
    --------------------------------------------------------- */
    @media (prefers-color-scheme: dark) {
      body {
        background-color: #121212 !important;
        color: #e9ecef !important;
      }
      .navbar {
        /* Gradasi hijau lebih gelap untuk navbar */
        background: linear-gradient(45deg, #1c7c54, #145f3f) !important;
        border-bottom: 2px solid #145f3f !important;
      }
      .card, .modal-content {
        background-color: #1e1e1e !important;
        color: #e9ecef !important;
      }
      .card-header, .modal-header {
        background-color: #343a40 !important;
        color: #e9ecef !important;
      }
      .my-modal-content {
        border: 1px solid #666 !important;
      }
      .card:hover {
        box-shadow: 0 4px 12px rgba(255,255,255,0.1) !important;
      }

      /* Tabel DataTables */
      table.dataTable thead th {
        background-color: #343a40 !important;
        color: #e9ecef !important;
      }
      table.dataTable thead th.sorting,
      table.dataTable thead th.sorting_asc,
      table.dataTable thead th.sorting_desc,
      table.dataTable thead th.sorting_asc_disabled,
      table.dataTable thead th.sorting_desc_disabled {
        background-color: #343a40 !important;
        color: #e9ecef !important;
      }
      table.dataTable tbody tr {
        background-color: #1e1e1e !important;
        color: #e9ecef !important;
      }
      table.dataTable tbody tr:hover {
        background-color: #333333 !important;
      }
      table.dataTable tbody tr td:first-child {
        background-color: #1e1e1e !important;
      }
      .dataTables_wrapper .dataTables_filter input,
      .dataTables_wrapper .dataTables_length select {
        color: #e9ecef !important;
        background-color: #1e1e1e !important;
      }
      .dataTables_wrapper .dataTables_filter label,
      .dataTables_wrapper .dataTables_length label,
      .dataTables_wrapper .dataTables_info {
        color: #e9ecef !important;
      }
      .dataTables_wrapper .dataTables_paginate .paginate_button {
        color: #e9ecef !important;
        background-color: #1e1e1e !important;
        border: 1px solid #3a3a3a !important;
      }
      .dataTables_wrapper .dataTables_paginate .paginate_button:hover {
        background-color: #343a40 !important;
        border-color: #1e1e1e !important;
      }

      /* Select2 di dark mode */
      .select2-container--default .select2-selection--single {
        background-color: #1e1e1e !important;
        color: #e9ecef !important;
        border: 1px solid #666 !important;
      }
      .select2-container--default .select2-selection__rendered {
        color: #e9ecef !important;
      }
      .select2-container--default .select2-results__option--selectable {
        background-color: #1e1e1e !important;
        color: #e9ecef !important;
      }
      .select2-container--default .select2-results__option--highlighted[aria-selected] {
        background-color: #333 !important;
        color: #e9ecef !important;
      }
      .select2-container--default .select2-results__message {
        background-color: #1e1e1e !important;
        color: #e9ecef !important;
      }
      .select2-container--default .select2-search--dropdown .select2-search__field {
        background-color: #1e1e1e !important;
        color: #e9ecef !important;
      }

      /* Dropdown menu & audio-player di dark mode */
      .dropdown-menu.show {
        background-color: #1e1e1e !important;
      }
      .dropdown-item {
        color: #e9ecef !important;
      }
      .dropdown-item:hover {
        background-color: #333 !important;
      }
      .audio-player {
        background: #333 !important;
        border: 1px solid #444 !important;
      }
      .audio-player button {
        color: #e9ecef !important;
      }
      .audio-player button:hover {
        color: #80ffa7 !important; /* sedikit lebih terang saat hover */
      }
    }

    /* ---------------------------------------------------------
       9. GARIS BAWAH UNTUK JUDUL
    --------------------------------------------------------- */
    .underline {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div id="app">
    <!-- Navbar -->
    <nav class="navbar navbar-dark" style="background-color: #28a745;">
      <a class="navbar-brand" href="#">Al-Qur'an Digital</a>
    </nav>
    
    <div class="container">
      <div class="row">
        <div class="col-lg-12">
          <!-- Daftar Surah -->
          <div class="card my-5 border-0 shadow">
            <div class="card-header my-card-header d-flex justify-content-between align-items-center">
              <span>Daftar Surah</span>
              <button class="btn btn-outline-light btn-sm" @click="refreshPage" title="Refresh">
                <i class="fas fa-sync-alt"></i>
              </button>
            </div>
            <div class="card-body">
              <div v-if="loading" class="d-flex justify-content-center">
                <div class="spinner"></div>
              </div>
              <div v-else>
                <table class="display table" id="list">
                  <thead>
                    <tr>
                      <th>No</th>
                      <th>Nama Surah</th>
                      <th>Arti</th>
                      <th>Jumlah Ayat</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr v-for="(data, idx) in table" :key="idx">
                      <td>{{ idx + 1 }}</td>
                      <td>
                        <a href="#" class="text-success" data-toggle="modal" data-target="#detailModal" 
                           @click="getDetail(data.nomor)">
                          {{ data.nama_latin }}<br>{{ data.nama }}
                        </a>
                      </td>
                      <td>{{ data.arti }}</td>
                      <td>{{ data.jumlah_ayat }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          
          <!-- Modal Detail -->
          <div class="modal fade" id="detailModal" tabindex="-1" aria-labelledby="detailModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-xl">
              <div class="modal-content my-modal-content">
                <div class="modal-header my-modal-header">
                  <h5 style="font-size: 2rem;" id="detailModalLabel">
                    Surat <span :class="{'alfatihah-text': detail.nomor == 1}">{{ detail.asma }}</span>
                  </h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body">
                  <div v-if="loading2" class="d-flex justify-content-center">
                    <div class="spinner"></div>
                  </div>
                  <div v-else>
                    <div class="row p-1">
                      <!-- Panel Metadata Surah & Audio Surah -->
                      <div class="col-lg-6">
                        <dl class="row">
                          <dt class="col-sm-3">Nama</dt>
                          <dd class="col-sm-9">
                            {{ detail.nama }}<br>{{ detail.asma }}
                          </dd>
                          <dt class="col-sm-3">Arti</dt>
                          <dd class="col-sm-9">{{ detail.arti }}</dd>
                          <dt class="col-sm-3">Diturunkan di</dt>
                          <dd class="col-sm-9">{{ detail.type }}</dd>
                          <dt class="col-sm-3">Audio Surah</dt>
                          <dd style="margin-left: 10px;">
                            <div class="audio-player" v-if="surahAudio">
                              <button @click="rewindSurahAudio"><i class="fas fa-backward"></i></button>
                              <button @click="toggleSurahAudio">
                                <i :class="{'fas fa-pause': surahAudioPlaying, 'fas fa-play': !surahAudioPlaying}"></i>
                              </button>
                              <input type="range" min="0" :max="surahAudioDuration" step="0.1" 
                                     v-model="surahAudioCurrent" @input="seekSurahAudio">
                              <button @click="forwardSurahAudio"><i class="fas fa-forward"></i></button>
                              <span>{{ formatTime(surahAudioCurrent) }} / {{ formatTime(surahAudioDuration) }}</span>
                            </div>
                            <div v-else>
                              <em>Tidak ada audio surah</em>
                            </div>
                          </dd>
                          <dt class="col-sm-3 text-truncate">Keterangan</dt>
                          <dd class="col-sm-9 border border-secondary" style="max-height: 250px; overflow-y: scroll;">
                            <span v-html="detail.keterangan"></span>
                          </dd>
                        </dl>
                      </div>
                      
                      <!-- Panel Bacaan Surat -->
                      <div class="col-lg-6">
                        <h3 class="underline">Bacaan Surat {{ detail.asma }}</h3>
                        
                        <!-- Tampilkan Bismillah (kecuali Al-Fatihah tetap pakai style "alfatihah-text" di judul) -->
                        <div v-if="detail.nomor !== 1" class="text-center mb-3" style="font-family: 'Lateef', serif; font-size: 2rem; color: #28a745;">
                          بِسْمِ اللَّهِ الرَّحْمَٰنِ الرَّحِيمِ
                        </div>
                        
                        <!-- Select2 untuk lompat ke ayat -->
                        <div class="mb-3">
                          <select id="ayatSelect" style="width: 100%;"></select>
                        </div>
                        
                        <!-- Daftar Ayat -->
                        <div class="border border-success p-3" style="max-height: 450px; overflow-y: scroll; border-radius: 8px;">
                          <span v-for="(ayat, idx) in ayats" :key="ayat.nomor" :id="'ayat-' + ayat.nomor">
                            <p>
                              <span class="badge badge-pill badge-success">Ayat {{ ayat.nomor }}</span>
                            </p>
                            <p class="arabic-text">{{ ayat.ar }}</p>
                            <p>
                              <small v-html="(ayat.tr && ayat.tr.trim()) ? ayat.tr : '(Transliterasi tidak tersedia)'"></small><br>
                              <small class="text-left font-italic">
                                {{ (ayat.id && ayat.id.trim()) ? ayat.id : '(Terjemahan tidak tersedia)' }}
                              </small>
                            </p>
                            <div class="mt-2">
                              <!-- Tombol Copy -->
                              <button class="btn btn-sm btn-outline-secondary" @click="copyAyat(idx+1, ayat)">
                                <i v-if="copiedAyats[ayat.nomor]" class="fas fa-check copied-check"></i>
                                <i v-else class="fas fa-copy"></i> Copy
                              </button>
                              <!-- Tombol Play per Ayat -->
                              <button class="btn btn-sm btn-outline-primary ml-2" @click="togglePlay(ayat, idx)">
                                <i v-if="currentAudioIndex === idx && isPlaying" class="fas fa-stop"></i>
                                <i v-else class="fas fa-play"></i>
                                <span v-if="currentAudioIndex === idx && isPlaying"> Stop</span>
                                <span v-else> Play</span>
                              </button>
                              <!-- Tombol Share -->
                              <div class="btn-group ml-2">
                                <button type="button" class="btn btn-sm btn-success dropdown-toggle" data-toggle="dropdown">
                                  Share
                                </button>
                                <div class="dropdown-menu">
                                  <a class="dropdown-item" href="#" @click.prevent="shareAyat('whatsapp', ayat)">
                                    <i class="fab fa-whatsapp"></i> WhatsApp
                                  </a>
                                  <a class="dropdown-item" href="#" @click.prevent="shareAyat('facebook', ayat)">
                                    <i class="fab fa-facebook-f"></i> Facebook
                                  </a>
                                  <a class="dropdown-item" href="#" @click.prevent="shareAyat('instagram', ayat)">
                                    <i class="fab fa-instagram"></i> Instagram
                                  </a>
                                </div>
                              </div>
                            </div>
                            <hr>
                          </span>
                        </div>
                      </div>
                    </div><!-- End row -->
                  </div>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary text-light" data-dismiss="modal">Close</button>
                </div>
              </div>
            </div>
          </div>
          <!-- End Modal -->
        </div>
      </div>
    </div>
  </div>
  
  <!-- jQuery, DataTables, Popper, Bootstrap JS -->
  <script 
    src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
    integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
    crossorigin="anonymous">
  </script>
  <script 
    src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js">
  </script>
  <script 
    src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
    integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
    crossorigin="anonymous">
  </script>
  <script 
    src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"
    integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV"
    crossorigin="anonymous">
  </script>
  <!-- Vue.js dan Vue Resource -->
  <script 
    src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js">
  </script>
  <script 
    src="https://cdn.jsdelivr.net/npm/vue-resource@1.5.1">
  </script>
  <!-- Select2 JS -->
  <script 
    src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js">
  </script>
  
  <script>
    var app = new Vue({
      el: '#app',
      data: {
        table: [],                 // Daftar surah (dari equran.id)
        detail: {},                // Detail surah terpilih
        ayats: [],                 // Data ayat dari properti "ayat" di detail
        loading: false,
        loading2: false,
        audioUrl: '',              // URL audio surah penuh
        surahAudio: null,
        surahAudioPlaying: false,
        surahAudioCurrent: 0,
        surahAudioDuration: 0,
        currentAudio: null,        // Objek Audio per ayat
        currentAudioIndex: null,
        isPlaying: false,
        copiedAyats: {}
      },
      methods: {
        refreshPage() {
          window.location.reload();
        },
        // Fungsi pembantu untuk zero-padding (misal: 1 menjadi "001")
        padNumber(num, digits) {
          return num.toString().padStart(digits, '0');
        },
        // Ambil detail surah + data ayat
        getDetail(nomorSurah) {
          this.loading2 = true;
          this.$http.get(`https://equran.id/api/surat/${nomorSurah}`)
            .then(response => {
              let res = response.body;
              // Set detail surah
              this.detail = {
                nomor:       res.nomor,
                nama:        res.nama,        // Teks Arab
                asma:        res.nama_latin,  // Nama Latin
                arti:        res.arti,
                type:        res.tempat_turun,
                keterangan:  res.deskripsi || ""
              };
              // Mapping data ayat (properti "ayat" di respons equran.id)
              let rawAyats = res.ayat || [];
              this.ayats = rawAyats.map(a => {
                // URL audio utama (menggunakan cdn.islamic.network)
                let primaryAudio = `https://cdn.islamic.network/quran/audio/128/ar.alafasy/${this.padNumber(nomorSurah, 3)}_${this.padNumber(a.nomor, 3)}.mp3`;
                // Fallback audio (opsional)
                let fallbackAudio = `https://everyayah.com/data/Abdul_Basit_Mujawwad_128kbps/${this.padNumber(nomorSurah, 3)}${this.padNumber(a.nomor, 3)}.mp3`;
                return {
                  nomor: a.nomor,
                  ar: a.ar,
                  tr: a.tr,
                  id: a.idn,  // Terjemahan Bahasa Indonesia
                  audio: primaryAudio,
                  fallbackAudio: fallbackAudio
                };
              });
              // Susun URL audio surah penuh
              this.getAudioSurah(nomorSurah);
              this.initSurahAudio();
              this.loading2 = false;
              this.$nextTick(() => {
                this.initSelect2();
              });
            })
            .catch(err => {
              console.error('getDetail error', err);
              this.loading2 = false;
            });
        },
        // URL audio surah full
        getAudioSurah(nomor) {
          this.audioUrl = `https://cdn.islamic.network/quran/audio-surah/128/ar.alafasy/${nomor}.mp3`;
        },
        initSurahAudio() {
          if (this.surahAudio) {
            this.surahAudio.pause();
          }
          this.surahAudio = new Audio(this.audioUrl);
          this.surahAudio.addEventListener('loadedmetadata', () => {
            this.surahAudioDuration = this.surahAudio.duration;
          });
          this.surahAudio.addEventListener('timeupdate', () => {
            this.surahAudioCurrent = this.surahAudio.currentTime;
          });
          this.surahAudio.addEventListener('ended', () => {
            this.surahAudioPlaying = false;
          });
        },
        toggleSurahAudio() {
          if (!this.surahAudio) return;
          if (this.surahAudioPlaying) {
            this.surahAudio.pause();
            this.surahAudioPlaying = false;
          } else {
            this.surahAudio.play();
            this.surahAudioPlaying = true;
          }
        },
        rewindSurahAudio() {
          if (this.surahAudio) {
            this.surahAudio.currentTime = Math.max(0, this.surahAudio.currentTime - 5);
          }
        },
        forwardSurahAudio() {
          if (this.surahAudio) {
            this.surahAudio.currentTime = Math.min(this.surahAudioDuration, this.surahAudio.currentTime + 5);
          }
        },
        seekSurahAudio(e) {
          if (!this.surahAudio) return;
          this.surahAudio.currentTime = e.target.value;
        },
        formatTime(sec) {
          let m = Math.floor(sec / 60);
          let s = Math.floor(sec % 60);
          return `${m}:${s < 10 ? '0' : ''}${s}`;
        },

        // Pemutaran audio ayat per ayat
        togglePlay(item, idx) {
          if (this.currentAudio && this.currentAudioIndex === idx) {
            // Sudah diputar, maka toggle play/pause
            if (this.isPlaying) {
              this.currentAudio.pause();
              this.isPlaying = false;
            } else {
              this.currentAudio.play();
              this.isPlaying = true;
            }
          } else {
            // Jika ganti ayat
            if (this.currentAudio) {
              this.currentAudio.pause();
            }
            if (item.audio) {
              this.currentAudio = new Audio(item.audio);
              this.currentAudioIndex = idx;
              this.isPlaying = true;
              // Error? Coba fallback
              this.currentAudio.onerror = () => {
                console.error("Primary audio failed for ayat", item.nomor, ", trying fallback audio.");
                if (item.fallbackAudio) {
                  this.currentAudio.src = item.fallbackAudio;
                  this.currentAudio.load();
                  this.currentAudio.play().catch(err => console.error("Fallback audio also failed:", err));
                }
              };
              // Setelah satu ayat selesai, auto lanjut ke ayat berikutnya
              this.currentAudio.onended = () => {
                let nextIdx = idx + 1;
                if (nextIdx < this.ayats.length && this.ayats[nextIdx].audio) {
                  this.togglePlay(this.ayats[nextIdx], nextIdx);
                  let t = document.getElementById(`ayat-${nextIdx+1}`);
                  if (t) t.scrollIntoView({ behavior: "smooth", block: "start" });
                } else {
                  this.isPlaying = false;
                  this.currentAudio = null;
                  this.currentAudioIndex = null;
                }
              };
              // Play
              this.currentAudio.play();
              // Scroll ke ayat
              let t = document.getElementById(`ayat-${idx+1}`);
              if (t) t.scrollIntoView({ behavior: "smooth", block: "start" });
            }
          }
        },

        // Copy ayat
        copyAyat(idx, item) {
          let text = `Ayat ${idx}\nArab: ${item.ar}\nLatin: ${item.tr}\nTerjemahan: ${item.id}`;
          if (navigator.clipboard) {
            navigator.clipboard.writeText(text)
              .then(() => {
                this.$set(this.copiedAyats, item.nomor, true);
                setTimeout(() => this.$delete(this.copiedAyats, item.nomor), 1000);
              })
              .catch(err => console.error("Gagal menyalin:", err));
          } else {
            // Fallback method
            let ta = document.createElement("textarea");
            ta.value = text;
            document.body.appendChild(ta);
            ta.select();
            try {
              document.execCommand('copy');
              this.$set(this.copiedAyats, item.nomor, true);
              setTimeout(() => this.$delete(this.copiedAyats, item.nomor), 1000);
            } catch (err) {
              console.error("Gagal menyalin:", err);
            }
            document.body.removeChild(ta);
          }
        },

        // Share ayat
        shareAyat(platform, item) {
          let text = `${item.ar}\n\n${item.id}\n\n(Dibagikan dari aplikasi Al-Qur'an)`;
          if (platform === 'whatsapp') {
            window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank');
          } else if (platform === 'facebook') {
            let url = 'https://example.com';
            window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}&quote=${encodeURIComponent(text)}`, '_blank');
          } else if (platform === 'instagram') {
            window.open('https://instagram.com/', '_blank');
          }
        },

        initSelect2() {
          let options = this.ayats.map(a => {
            return { 
              id: a.nomor, 
              text: `Ayat ${a.nomor}: ${a.ar.substring(0, 20)}...`
            };
          });
          $('#ayatSelect').select2({
            placeholder: 'Pilih ayat...',
            allowClear: true,
            data: options
          });
          $('#ayatSelect').off('change').on('change', () => {
            let val = $('#ayatSelect').val();
            if (val) {
              let t = document.getElementById(`ayat-${val}`);
              if (t) t.scrollIntoView({ behavior: "smooth", block: "start" });
            }
          });
        }
      },
      mounted() {
        this.loading = true;
        // Ambil daftar surah
        this.$http.get('https://equran.id/api/surat')
          .then(res => {
            this.table = res.body;
            this.loading = false;
            this.$nextTick(() => {
              $('#list').DataTable({
                paging: true,
                searching: true,
                info: true,
                language: {
                  paginate: {
                    previous: '<i class="fa fa-chevron-left"></i>',
                    next: '<i class="fa fa-chevron-right"></i>'
                  }
                },
                columnDefs: [
                  {
                    targets: 0,
                    searchable: false,
                    orderable: false,
                    data: null,
                    render: function(data, type, row, meta) {
                      return meta.row + 1;
                    }
                  }
                ]
              });
            });
          })
          .catch(err => {
            console.log('error', err);
            this.loading = false;
          });
      }
    });
  </script>
</body>
</html>
