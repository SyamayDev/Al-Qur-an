<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="Description" content="Al-Qur'an Online Dengan Terjemahan Bahasa Indonesia">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" 
          href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" 
          integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" 
          crossorigin="anonymous">
    <!-- Font Awesome (untuk icon refresh & pagination) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet">

    <!-- DataTables CSS -->
    <link href="https://cdn.datatables.net/1.10.22/css/jquery.dataTables.min.css" rel="stylesheet">

    <title>Al-Qur'an</title>
    
    <!-- CSS untuk animasi loading manual dan dark/light mode -->
    <style>
      /* Animasi spinner manual */
      .spinner {
        width: 100px;
        height: 100px;
        border: 12px solid #f3f3f3;
        border-top: 12px solid #28a745; /* Warna hijau sesuai tema */
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }

      /* Default (light) theme */
      body {
        background-color: #fff;
        color: #212529;
      }
      .card, .modal-content {
        background-color: #fff;
        color: #212529;
      }
      /* DataTables (light mode) */
      table.dataTable thead th {
        background-color: #e9ecef;
        color: #212529;
      }

      /* Agar DataTables tidak meluber keluar card body */
      .card-body {
        overflow-x: hidden;
      }
      .dataTables_wrapper {
        width: 100%;
        max-width: 100%;
        overflow-x: hidden;
      }

      /* Memperkecil padding pada DataTables agar lebih responsive */
      table.dataTable thead th, 
      table.dataTable tbody td {
        padding: 0.5rem;
      }

      table.dataTable {
        width: 100% !important;
        table-layout: auto !important;
        white-space: normal !important;
        /* word-break: break-word;  // Aktifkan jika ada kata super panjang */
      }

      /*
        DARK MODE
        Override warna agar tidak berantakan, termasuk saat kolom disort.
      */
      @media (prefers-color-scheme: dark) {
        body {
          background-color: #121212;
          color: #e9ecef;
        }
        .navbar {
          background-color: #1c7c54 !important;
        }
        .card, .modal-content {
          background-color: #1e1e1e !important;
          color: #e9ecef !important;
        }
        .card-header, .modal-header {
          background-color: #343a40 !important;
          color: #e9ecef !important;
        }
        .bg-success {
          background-color: #1c7c54 !important;
        }
        
        /* Header tabel */
        table.dataTable thead th {
          background-color: #343a40 !important;
          color: #e9ecef !important;
        }

        /* Override semua kelas sorting agar tetap dark saat di-sort */
        table.dataTable thead th.sorting,
        table.dataTable thead th.sorting_asc,
        table.dataTable thead th.sorting_desc,
        table.dataTable thead th.sorting_asc_disabled,
        table.dataTable thead th.sorting_desc_disabled {
          background-color: #343a40 !important;
          color: #e9ecef !important;
        }

        /* Aturan untuk baris yang sedang disorot (sorting_1) */
        table.dataTable.display tbody tr.even > .sorting_1, 
        table.dataTable.order-column.stripe tbody tr.even > .sorting_1,
        table.dataTable.display tbody tr.odd > .sorting_1, 
        table.dataTable.order-column.stripe tbody tr.odd > .sorting_1 {
          background-color: #1e1e1e !important;
          color: #e9ecef !important;
        }

        /* Tabel body */
        table.dataTable tbody tr {
          background-color: #1e1e1e !important;
          color: #e9ecef !important;
        }

        /* Warna hover baris tabel */
        table.dataTable tbody tr:hover {
          background-color: #333333 !important;
        }

        /* Background nomor */
        table.dataTable tbody tr td:first-child {
          background-color: #1e1e1e !important;
        }

        /* Tulisan di kontrol DataTables */
        .dataTables_wrapper .dataTables_filter input,
        .dataTables_wrapper .dataTables_length select {
          color: #e9ecef !important;
        }
        .dataTables_wrapper .dataTables_filter label,
        .dataTables_wrapper .dataTables_length label,
        .dataTables_wrapper .dataTables_info {
          color: #e9ecef !important;
        }
        /* Tombol paging */
        .dataTables_wrapper .dataTables_paginate .paginate_button {
          color: #e9ecef !important;
          background-color: #1e1e1e !important;
          border: 1px solid #3a3a3a !important;
        }
        .dataTables_wrapper .dataTables_paginate .paginate_button:hover {
          background-color: #343a40 !important;
          border-color: #1e1e1e !important;
        }
      }
    </style>
  </head>
  <body>
      
    <div id="app">
      <!-- Navbar tanpa tombol hamburger; tombol Refresh diposisikan di sebelah kiri judul di card header -->
      <nav class="navbar navbar-dark bg-success">
        <a class="navbar-brand" href="index.html">Al-Qur'an</a>
      </nav>
      
      <div class="container">
        <div class="row">
          <div class="col-lg-12">
            <div class="card my-5 border-0 shadow">
              <!-- Card header dengan judul dan tombol refresh (ikon) -->
              <div class="card-header bg-success text-light d-flex justify-content-between align-items-center">
                <span>Daftar Surah</span>
                <button class="btn btn-outline-light btn-sm" @click="refreshPage" title="Refresh">
                  <i class="fas fa-sync-alt"></i>
                </button>
              </div>
              <div class="card-body">
                <!-- Animasi loading manual -->
                <div v-if="loading" class="d-flex justify-content-center">
                  <div class="spinner"></div>
                </div>
                <div v-else>
                  <table class="display table" id="list">
                    <thead>
                      <tr>
                        <th>No</th>
                        <th>Nama Surah</th>
                        <th>Arti</th>
                        <th>Jumlah Ayat</th>
                      </tr>
                    </thead>
                    <tbody>
                      <!-- Kolom pertama dikosongkan agar DataTables yang mengisinya -->
                      <tr v-for="data in table" :key="data.nomor">
                        <td></td>
                        <td>
                          <a href="#" class="text-success" data-toggle="modal" data-target="#detailModal" 
                             @click="getDetail(data.nomor - 1)">
                            {{ data.asma }}<br>
                            {{ data.nama }}
                          </a>
                        </td>
                        <td>{{ data.arti }}</td>
                        <td>{{ data.ayat }}</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
            
            <!-- Modal Detail -->
            <div class="modal fade" id="detailModal" tabindex="-1" aria-labelledby="detailModalLabel" aria-hidden="true">
              <div class="modal-dialog modal-xl">
                <div class="modal-content border border-success">
                  <div class="modal-header bg-success text-light">
                    <h5 class="modal-title" id="detailModalLabel">Surat {{ detail.nama }}</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body">
                    <!-- Animasi loading manual di modal -->
                    <div v-if="loading2" class="d-flex justify-content-center">
                      <div class="spinner"></div>
                    </div>
                    <div v-else>
                      <div class="row p-1">
                        <div class="col-lg-6">
                          <dl class="row">
                            <dt class="col-sm-3">Nama</dt>
                            <dd class="col-sm-9">
                              {{ detail.asma }}<br>
                              {{ detail.nama }}
                            </dd>
                            <dt class="col-sm-3">Arti</dt>
                            <dd class="col-sm-9">{{ detail.arti }}</dd>
                            <dt class="col-sm-3">Diturunkan di</dt>
                            <dd class="col-sm-9">{{ detail.type }}</dd>
                            <dt class="col-sm-3">Audio</dt>
                            <dd class="col-sm-9">
                              <audio :src="audioUrl" controls></audio>
                            </dd>
                            <dt class="col-sm-3 text-truncate">Keterangan</dt>
                            <dd class="col-sm-9 border border-secondary" style="max-height: 250px; overflow-y: scroll;">
                              <span v-html="detail.keterangan"></span>
                            </dd>
                          </dl>
                        </div>
                        <div class="col-lg-6">
                          <h3 class="h3 underline">Bacaan Surah {{ detail.nama }}</h3>
                          <div class="border border-success p-3" style="max-height: 450px; overflow-y: scroll;">
                            <span v-for="(ayat, index) in ayats" :key="index">
                              <p>
                                <span class="badge badge-pill badge-success">
                                  {{ detail.nomor }}:{{ ayat.nomor }}
                                </span>
                                <p class="text-right">{{ ayat.ar }}</p>
                              </p>
                              <small v-html="ayat.tr"></small><br>
                              <small class="text-left font-italic">{{ ayat.id }}</small>
                              <hr>
                            </span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary text-light" data-dismiss="modal">Close</button>
                  </div>
                </div>
              </div>
            </div>
            <!-- End Modal -->
            
          </div>
        </div>
      </div>
    </div>
    
    <!-- jQuery, DataTables, Popper, Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" 
            integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" 
            crossorigin="anonymous"></script>
    
    <!-- DataTables JS -->
    <script src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" 
            integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" 
            crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" 
            integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" 
            crossorigin="anonymous"></script>
    
    <!-- Vue.js dan Vue Resource -->
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue-resource@1.5.1"></script>
    
    <script>
      var app = new Vue({
        el: '#app',
        data: {
          table: [],
          detail: {},
          ayats: [],
          loading: false,
          loading2: false,
          audioUrl: ''
        },
        methods: {
          getDetail(index) {
            this.loading2 = true;
            this.$http.get('https://api.npoint.io/99c279bb173a6e28359c/data/' + index + '/')
              .then(response => {
                this.detail = response.body;
                this.getSurah(response.body.nomor);
                this.getAudio(response.body.nomor);
              }, response => {
                console.log('getDetail error ' + response);
              });
          },
          getSurah(nomor) {
            this.$http.get('https://api.npoint.io/99c279bb173a6e28359c/surat/' + nomor + '/')
              .then(response => {
                this.ayats = response.body;
                this.loading2 = false;
              }, response => {
                console.log('getAyat error ' + response);
              });
          },
          getAudio(nomor) {
            // Mendapatkan URL audio menggunakan Quran.com API dari Alafasy recitation
            this.audioUrl = `https://cdn.islamic.network/quran/audio-surah/128/ar.alafasy/${nomor}.mp3`;
          },
          refreshPage() {
            window.location.reload();
          }
        },
        mounted() {
          this.loading = true;
          this.$http.get('https://api.npoint.io/99c279bb173a6e28359c/data/')
            .then(response => {
              this.table = response.body;
              this.loading = false;
              this.$nextTick(function() {
                $('#list').DataTable({
                  paging: true,
                  searching: true,
                  info: true,
                  language: {
                    paginate: {
                      previous: '<i class="fa fa-chevron-left"></i>',
                      next: '<i class="fa fa-chevron-right"></i>'
                    }
                  },

                  columnDefs: [
                    {
                      targets: 0,
                      searchable: false,
                      orderable: false,
                      data: null,
                      render: function (data, type, row, meta) {
                        return meta.row + 1; 
                      }
                    }
                  ]
                });
              });
            }, response => {
              console.log('error ' + response);
            });
        },
      });
    </script>
  </body>
</html>

